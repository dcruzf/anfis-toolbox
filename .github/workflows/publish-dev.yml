name: Publish DEV Package

on:
  push:
    branches:
      - dev

permissions:
  contents: read

jobs:
  publish:
    if: contains(github.event.head_commit.message, '[publish]')
    name: Publish
    runs-on: ubuntu-latest
    environment: dev
    env:
      HATCH_INDEX_REPO: ${{ vars.HATCH_INDEX_REPO }}
      HATCH_INDEX_USER: ${{ vars.HATCH_INDEX_USER }}
      HATCH_INDEX_AUTH: ${{ secrets.HATCH_INDEX_AUTH }}
    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout repository
      uses: actions/checkout@v5
      with:
        fetch-depth: 0

    - name: Install Hatch
      uses: pypa/hatch@install

    - name: Test
      run: hatch test --all -c

    - name: Build project
      run: hatch build

    - name: Publish
      run: hatch publish
